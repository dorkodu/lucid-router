{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["type PageCallback = (...args: any[]) => void;\r\n\r\ninterface Route {\r\n  pattern: RegExp;\r\n  cb?: PageCallback;\r\n}\r\n\r\ninterface Redirect {\r\n  from: RegExp;\r\n  to: string;\r\n  cb?: PageCallback;\r\n}\r\n\r\nlet _use: \"hash\" | \"history\";\r\nlet _url: string = \"/\";\r\nlet _routes: Route[] = [];\r\nlet _redirects: Redirect[] = [];\r\nlet _fallback: (() => void) | undefined;\r\n\r\nfunction run(use: \"hash\" | \"history\", cb?: () => void) {\r\n  _use = use;\r\n\r\n  if (cb) cb();\r\n\r\n  if (use === \"hash\")\r\n    window.addEventListener(\"hashchange\", () => { to() })\r\n\r\n  to();\r\n}\r\n\r\nfunction to(url?: string) {\r\n  switch (_use) {\r\n    case \"hash\":\r\n      if (!url) {\r\n        const hashUrl = window.location.hash.substring(1);\r\n        if (hashUrl !== \"\" && hashUrl !== \"/\") _url = hashUrl;\r\n      }\r\n      else {\r\n        _url = url;\r\n        window.location.hash = _url;\r\n        return;\r\n      }\r\n      break;\r\n    case \"history\":\r\n      // TODO: Implement\r\n      //if (!url) {\r\n      //  url = window.location.pathname;\r\n      //\r\n      //  if (url.length > 1 && url.lastIndexOf(\"/\") === url.length - 1)\r\n      //    url = url.substring(0, url.length - 1);\r\n      //}\r\n      //else {\r\n      //  window.history.replaceState(null, \"\", url);\r\n      //}\r\n      break;\r\n    default:\r\n      return;\r\n  }\r\n\r\n  // Handle redirect\r\n  for (let i = 0; i < _redirects.length; ++i) {\r\n    const match = _url.match(_redirects[i].from);\r\n    if (match) {\r\n      const oldUrl = _url;\r\n      if (_redirects[i].cb) (_redirects[i].cb as PageCallback)(...match.slice(1));\r\n      const newUrl = _url;\r\n\r\n      if (oldUrl === newUrl) {\r\n        if (_use === \"hash\") {\r\n\r\n          window.location.hash = _redirects[i].to;\r\n          return;\r\n        }\r\n        else {\r\n          //_url = _redirects[i].to;\r\n          //window.history.replaceState(null, \"\", _url);\r\n        }\r\n      }\r\n      else {\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle routes\r\n  for (let i = 0; i < _routes.length; ++i) {\r\n    const match = _url.match(_routes[i].pattern);\r\n    if (match) {\r\n      if (_routes[i].cb) (_routes[i].cb as PageCallback)(...match.slice(1));\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Handle fallback\r\n  if (_fallback)\r\n    _fallback();\r\n}\r\n\r\nfunction route(pattern: string, cb?: PageCallback) {\r\n  _routes.push({\r\n    pattern: new RegExp(\"^\" + pattern + \"$\", \"i\"),\r\n    cb: cb\r\n  })\r\n}\r\n\r\nfunction redirect(pattern: string, to: string, cb?: PageCallback) {\r\n  _redirects.push({\r\n    from: new RegExp(\"^\" + pattern + \"$\", \"i\"),\r\n    to: to,\r\n    cb: cb\r\n  })\r\n}\r\n\r\nfunction fallback(cb: () => void) {\r\n  _fallback = cb;\r\n}\r\n\r\nexport const superpage = {\r\n  run,\r\n  to,\r\n  route,\r\n  redirect,\r\n  fallback\r\n};"],"names":[],"mappings":"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"}