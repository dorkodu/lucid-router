{"version":3,"file":"index.js","sources":["../src/index.ts"],"sourcesContent":["let _use: \"hash\" | \"history\";\r\nlet _routes: { pattern: RegExp, cb?: (...args: any[]) => void }[] = [];\r\nlet _redirects: { from: RegExp, to: string, cb?: (...args: any[]) => void }[] = [];\r\nlet _fallback: (() => void) | undefined;\r\n\r\nfunction run(use: \"hash\" | \"history\", cb?: () => void) {\r\n  _use = use;\r\n\r\n  if (cb) cb();\r\n\r\n  if (use === \"hash\")\r\n    window.addEventListener(\"hashchange\", () => { to() })\r\n\r\n  to();\r\n}\r\n\r\nfunction to(url?: string) {\r\n  switch (_use) {\r\n    case \"hash\":\r\n      if (!url) {\r\n        url = \"/\" + window.location.hash.substring(1);\r\n      }\r\n      else {\r\n        window.location.hash = url.substring(1);\r\n        return;\r\n      }\r\n      break;\r\n    case \"history\":\r\n      if (!url) {\r\n        url = window.location.pathname;\r\n\r\n        if (url.length > 1 && url.lastIndexOf(\"/\") === url.length - 1)\r\n          url = url.substring(0, url.length - 1);\r\n      }\r\n      else {\r\n        window.history.replaceState(null, \"\", url);\r\n      }\r\n      break;\r\n    default:\r\n      return;\r\n  }\r\n\r\n  // Handle redirect\r\n  for (let i = 0; i < _redirects.length; ++i) {\r\n    const match = url.match(_redirects[i].from);\r\n    if (match) {\r\n      const oldUrl = url;\r\n      if (_redirects[i].cb) (_redirects[i].cb as any)(...match.slice(1));\r\n      const newUrl = url;\r\n\r\n      if (oldUrl === newUrl) {\r\n        if (_use === \"hash\") {\r\n          window.location.hash = _redirects[i].to;\r\n          return;\r\n        }\r\n        else {\r\n          url = _redirects[i].to;\r\n          window.history.replaceState(null, \"\", url);\r\n        }\r\n      }\r\n      else {\r\n        return;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle routes\r\n  for (let i = 0; i < _routes.length; ++i) {\r\n    const match = url.match(_routes[i].pattern);\r\n    if (match) {\r\n      if (_routes[i].cb) (_routes[i].cb as any)(...match.slice(1));\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Handle fallback\r\n  if (_fallback)\r\n    _fallback();\r\n}\r\n\r\nfunction route(pattern: string, cb?: (...args: any[]) => void) {\r\n  _routes.push({\r\n    pattern: new RegExp(\"^\" + pattern + \"$\", \"i\"),\r\n    cb: cb\r\n  })\r\n}\r\n\r\nfunction redirect(pattern: string, to: string, cb?: (...args: any[]) => void) {\r\n  _redirects.push({\r\n    from: new RegExp(\"^\" + pattern + \"$\", \"i\"),\r\n    to: to,\r\n    cb: cb\r\n  })\r\n}\r\n\r\nfunction fallback(cb: () => void) {\r\n  _fallback = cb;\r\n}\r\n\r\nexport const superpage = {\r\n  run,\r\n  to,\r\n  route,\r\n  redirect,\r\n  fallback\r\n};"],"names":[],"mappings":"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"}